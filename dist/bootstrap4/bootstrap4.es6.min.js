const t=()=>{let t=!1;try{const i={get passive(){return t=!0,!0}};window.addEventListener("test",null,i),window.removeEventListener("test",null,i)}catch(i){return t=!1,!1}return t},i=function(t,i){let e;return function(...s){e&&clearTimeout(e),e=setTimeout(()=>{i(...s),e=null},t)}},e={validClass:"is-valid",invalidClass:"is-invalid",indicator:!0,indicatorElement:"span",indicatorPosition:"after",indicatorClass:"invalid-feedback",invalidForm:"Form is not valid!",invalidFormAlert:!1};class s{constructor(s){if(this.form=s,!s||"HTMLFormElement"!==s.constructor.name)throw new Error("Validator needs a form element");this.form.hasAttribute("novalidate")||(this.options=e,this.form.Formally=this,this.passiveSupported=t(),this.elementsForValidation=[],this.validateFormElement=this.validateFormElement.bind(this),this.attachElement=this.attachElement.bind(this),this.elementInit=this.elementInit.bind(this),this.notify=this.notify.bind(this),this.invalidFormNotification=this.invalidFormNotification.bind(this),this.debounced=i(99,this.validateFormElement),this.init())}invalidFormNotification(){}notify(){}elementInit(){}validateFormElement(t){let i=null;if(i=t&&t.target?t.target:t,!i)throw new Error("Method formElementValidate needs a valid event.target or a form element");Object.prototype.hasOwnProperty.call(i,"FormallyCustomValidator")&&"function"==typeof i.FormallyCustomValidator?(i.FormallyCustomValidator(),this.notify&&"function"==typeof this.notify&&this.notify(i,i.validity.valid)):(i.checkValidity(),this.notify&&"function"==typeof this.notify&&this.notify(i,i.validity.valid))}getCustomMessage(t,i,e){if(!t||!i||!e)return null;const s=t.dataset;if("object"==typeof s){if(e.typeMismatch&&s[`${i}Mismatch`])return s[`${i}Mismatch`];for(const t in s)if(Object.prototype.hasOwnProperty.call(s,t)&&!0===e[t])return s[t]}return null}isValid(){let t="i";return this.elementsForValidation.forEach(i=>{const e=i.checkValidity();this.notify&&"function"==typeof this.notify&&this.notify(i,e),"string"==typeof t||e||(t=i)}),!!this.form.checkValidity()||(this.invalidFormNotification&&"function"==typeof this.invalidFormNotification&&this.invalidFormNotification(),"string"!=typeof t&&t.focus(),!1)}init(){if(this.form.dataset)for(const t in this.form.dataset)Object.prototype.hasOwnProperty.call(this.form.Formally.options,t)&&(this.form.Formally.options[t]="indicator"===t||"invalidFormAlert"===t?"true"===this.form.dataset[t]:this.form.dataset[t]);[].slice.call(this.form.elements).forEach(t=>{t.hasAttribute("disabled")||void 0!==t.dataset.allowValidation&&"true"===t.dataset.allowValidation||"FIELDSET"===t.tagName||(this.elementsForValidation.push(t),t.addEventListener("blur",this.debounced,!this.passiveSupported||{passive:!0}),t.addEventListener("change",this.debounced,!this.passiveSupported||{passive:!0}),t.addEventListener("input",this.debounced,!this.passiveSupported||{passive:!0}),this.options.indicator&&this.elementInit&&"function"==typeof this.elementInit&&this.elementInit(t))})}attachElement(t){t.hasAttribute("disabled")||void 0!==t.dataset.allowValidation&&"true"===t.dataset.allowValidation||!t.willValidate||(t.removeEventListener("blur",this.debounced,!this.passiveSupported||{passive:!0}),t.removeEventListener("change",this.debounced,!this.passiveSupported||{passive:!0}),t.removeEventListener("input",this.debounced,!this.passiveSupported||{passive:!0}),t.addEventListener("blur",this.debounced,!this.passiveSupported||{passive:!0}),t.addEventListener("change",this.debounced,!this.passiveSupported||{passive:!0}),t.addEventListener("input",this.debounced,!this.passiveSupported||{passive:!0}),this.options.indicator&&this.elementInit&&"function"==typeof this.elementInit&&this.elementInit(t))}}Object.defineProperty(s.prototype,"switchClasses",{writable:!0,configurable:!0,value(t,i){i?(t.classList.remove(this.options.invalidClass),t.classList.add(this.options.validClass)):(t.classList.remove(this.options.validClass),t.classList.add(this.options.invalidClass))}}),Object.defineProperty(s.prototype,"elementInit",{writable:!0,configurable:!0,value(t){if(t.hasAttribute("disabled"))return;let i=t.closest(`${this.options.indicatorElement}[aria-live]`);i||(i=document.createElement(this.options.indicatorElement)),i.setAttribute("aria-live","polite");const e=(()=>{let t=()=>Math.floor(65536*(1+Math.random())).toString(16).substring(1);return t()+t()+"-"+t()+t()})();i.id=e,t.setAttribute("aria-controls",e),i.classList.add(this.options.indicatorClass),"after"===this.options.indicatorPosition?(t.insertAdjacentElement("afterend",i),t.parentNode.appendChild(i)):"before"===this.options.indicatorPosition&&t.insertAdjacentElement("beforebegin",i)}}),Object.defineProperty(s.prototype,"notify",{writable:!0,configurable:!0,value(t,i){if(t.hasAttribute("disabled"))return;const e=t.getAttribute("type"),s=i?null:this.getCustomMessage(t,t.type,t.validity);if(this.switchClasses(t,i),e&&"radio"===e){this.elementsForValidation.filter(i=>i.name!==t.name).forEach(t=>{this.switchClasses(t,i)})}if(this.form.dataset&&0!==Object.keys(this.form.dataset).length&&"true"===this.form.dataset.indicator){if(s){t.setCustomValidity("");const i=t.parentNode.querySelector('[aria-live="polite"]');i&&(i.innerText=s)}}else document.activeElement===t&&t.reportValidity()}}),Object.defineProperty(s.prototype,"invalidFormNotification",{writable:!0,configurable:!0,value(){this.form.dataset.invalidFormAlert&&alert("Please correct the invalid iputs")}});export{s as Formally};
