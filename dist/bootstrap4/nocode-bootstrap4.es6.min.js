const t=()=>{let t=()=>Math.floor(65536*(1+Math.random())).toString(16).substring(1);return t()+t()+"-"+t()+t()},i=()=>{let t=!1;try{const i={get passive(){return t=!0,!0}};window.addEventListener("test",null,i),window.removeEventListener("test",null,i)}catch(i){return t=!1,!1}return t},e=function(t,i){let e;return function(...s){e&&clearTimeout(e),e=setTimeout(()=>{i(...s),e=null},t)}},s={validClass:"is-valid",invalidClass:"is-invalid",indicator:!0,indicatorElement:"span",indicatorPosition:"after",indicatorClass:"invalid-feedback",invalidForm:"Form is not valid!",invalidFormAlert:!1},a="hasAttribute",o="hasOwnProperty",n="addEventListener",r="removeEventListener";class l{constructor(t){if(this.form=t,!t||"HTMLFormElement"!==t.constructor.name)throw new Error("Validator needs a form element");if(!this.form[a]("novalidate")){if(this.options=s,this.form.dataset)for(const t in this.form.dataset)Object.prototype[o].call(this.options,t)&&(this.options[t]="indicator"===t||"invalidFormAlert"===t?"true"===this.form.dataset[t]:this.form.dataset[t]);this.passiveSupported=i(),this.elementsForValidation=[],this.formElementValidate=this.formElementValidate.bind(this),this.reAttachElement=this.reAttachElement.bind(this),this.debounced=e(99,this.formElementValidate),this.init(),this.form.Formally=this}}formInvalidNotification(){}notify(){}switchClasses(){}elementInit(){}formElementValidate(t){const i=t.target;i.FormallyCustomValidator&&"function"==typeof i.FormallyCustomValidator?i.customValidator():i.checkValidity(),this.notify(i)}getCustomMessage(t,i,e){const s=t.dataset;if("object"==typeof s){if(e.typeMismatch&&s[`${i}Mismatch`])return s[`${i}Mismatch`];for(const t in s)if(Object.prototype[o].call(s,t)&&e[t])return s[t]}return""}isValid(){return this.elementsForValidation.forEach(t=>{this.switchClasses(t,t.validity.valid),this.notify(t)}),!!this.form.checkValidity()||(this.formInvalidNotification(),!1)}init(){[].slice.call(this.form.elements).forEach(t=>{const i=t.tagName;if(i&&("INPUT"===i||"SELECT"===i||"TEXTAREA"===i)){if(t[a]("disabled")||void 0!==t.dataset.allowValidation&&"true"===t.dataset.allowValidation)return;this.elementsForValidation.push(t),t[n]("blur",this.debounced),this.passiveSupported,t[n]("change",this.debounced,!!this.passiveSupported&&{passive:!0}),"SELECT"!==i&&t[n]("input",this.debounced,!!this.passiveSupported&&{passive:!0}),this.options.indicator&&this.form.dataset&&0!==Object.keys(this.form.dataset).length&&this.elementInit(t)}})}reAttachElement(t){const i=t.tagName;t[r]("blur",this.debounced,!!this.passiveSupported&&{passive:!0}),t[r]("change",this.debounced,!!this.passiveSupported&&{passive:!0}),t[r]("input",this.debounced,!!this.passiveSupported&&{passive:!0}),!i||"INPUT"!==i&&"SELECT"!==i&&"TEXTAREA"!==i||(t[n]("blur",this.debounced,!!this.passiveSupported&&{passive:!0}),"SELECT"===i?t[n]("change",this.debounced,!!this.passiveSupported&&{passive:!0}):t[n]("input",this.debounced,!!this.passiveSupported&&{passive:!0}),this.options.indicator&&this.form.dataset&&0!==Object.keys(this.form.dataset).length&&this.elementInit(t))}}class d extends l{constructor(t){super(t)}switchClasses(t,i){i?(t.classList.remove(this.options.invalidClass),t.classList.add(this.options.validClass)):(t.classList.remove(this.options.validClass),t.classList.add(this.options.invalidClass))}elementInit(i){if(i.hasAttribute("disabled"))return;let e=i.closest(`${this.options.indicatorElement}[aria-live]`);e||(e=document.createElement(this.options.indicatorElement)),e.setAttribute("aria-live","polite");const s=t();e.id=s,i.setAttribute("aria-controls",s),e.classList.add(this.options.indicatorClass),"after"===this.options.indicatorPosition?(i.insertAdjacentElement("afterend",e),i.parentNode.appendChild(e)):"before"===this.options.indicatorPosition&&i.insertAdjacentElement("beforebegin",e)}notify(t){if(t.hasAttribute("disabled"))return;const i=t.validity.valid,e=t.getAttribute("type"),s=i?null:this.getCustomMessage(t,t.type,t.validity);if(this.switchClasses(t,i),e&&"radio"===e){const e=t.name;this.elementsForValidation.forEach(s=>{(s.name&&s.name===e||s===t)&&this.switchClasses(s,i)})}if(this.options.indicator){if(s){t.setCustomValidity("");const i=t.parentNode.querySelector('[aria-live="polite"]');i&&(i.innerText=s)}}else s&&t.setCustomValidity(s),t.reportValidity()}formInvalidNotification(){}}const h=Array.from(document.querySelectorAll("form:not([novalidate]"));window.Formally=d;h.forEach(t=>{new d(t)});export{d as Formally};
