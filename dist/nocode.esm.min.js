const t={instanceName:"Formally",customValidatorName:"FormallyCustomValidator",validClass:"is-valid",invalidClass:"is-invalid",indicator:!0,indicatorElement:"div",indicatorPosition:"after",indicatorClass:"invalid-feedback",attachChange:!1,attachInput:!1},s=()=>{let t=()=>Math.floor(65536*(1+Math.random())).toString(16).substring(1);return t()+"-"+t()+"-"+t()+"-"+t()+"-"+t()+t()};class i{constructor(s){if(this.form=s,!s||"HTMLFormElement"!==s.constructor.name)throw new Error("Validator needs a form element");if(!this.form.hasAttribute("novalidate")){if(this.options=t,this.form.dataset)for(const t in this.form.dataset)this.options.hasOwnProperty(t)&&(this.options[t]="indicator"===t||"attachChange"===t||"attachInput"===t?"true"===this.form.dataset[t]:this.form.dataset[t]);this.passiveSupported=!1,this.elementsForValidation=[],this.formElementValidate=this.formElementValidate.bind(this),this.reAttachElement=this.reAttachElement.bind(this),this.uaSupportsPassive(),this.init(),this.form[this.options.instanceName]=this}}uaSupportsPassive(){try{const t={get passive(){return this.passiveSupported=!0,!1}};window.addEventListener("test",null,t),window.removeEventListener("test",null,t)}catch(t){this.passiveSupported=!1}}formElementValidate(t){const s=t.target;"function"==typeof s[this.options.customValidatorName]?s.customValidator():(s.checkValidity(),this.changeHtmlMarkup(s))}getCustomMessage(t,s,i){var e=t.dataset;if("object"==typeof e){if(i.typeMismatch&&e[s+"Mismatch"])return e[s+"Mismatch"];for(var a in e)if(e.hasOwnProperty(a)&&i[a])return e[a]}}switchClasses(t,s){s?(t.classList.remove(this.options.invalidClass),t.classList.add(this.options.validClass)):(t.classList.remove(this.options.validClass),t.classList.add(this.options.invalidClass))}changeHtmlMarkup(t){const s=t.validity.valid,i=t.getAttribute("type"),e=s?null:this.getCustomMessage(t,t.type,t.validity);if(this.switchClasses(t,s),i&&"radio"===i){const i=t.name;this.elementsForValidation.forEach(e=>{(e.name&&e.name===i||e===t)&&this.switchClasses(e,s)})}if(this.options.indicator){if(e){t.setCustomValidity("");const s=t.parentNode.querySelector('[aria-live="polite"]');s&&(s.innerText=e)}}else e&&t.setCustomValidity(e),t.reportValidity()}isValid(){return this.elementsForValidation.forEach(t=>{t.validity.valid?(t.classList.remove(this.options.validClass),t.classList.add(this.options.validClass)):(t.classList.add(this.options.validClass),t.classList.remove(this.options.validClass)),this.changeHtmlMarkup(t)}),!!this.form.checkValidity()}init(){[].slice.call(this.form.elements).forEach(t=>{const i=t.tagName.toLowerCase();if(i&&("input"===i||"select"===i||"textarea"===i)&&(this.elementsForValidation.push(t),t.addEventListener("blur",this.formElementValidate),this.passiveSupported,(this.options.attachChange||this.form.dataset.attachChange)&&t.addEventListener("change",this.formElementValidate,!!this.passiveSupported&&{passive:!0}),(this.options.attachInput||this.form.dataset.attachInput)&&t.addEventListener("change",this.formElementValidate,!!this.passiveSupported&&{passive:!0}),this.options.indicator&&this.form.dataset&&0!==Object.keys(this.form.dataset).length)){const i=document.createElement(this.options.indicatorElement);if(i){i.setAttribute("aria-live","polite");const e=s();i.id=e,t.setAttribute("aria-controls",e),i.classList.add(this.options.indicatorClass),"after"===this.options.indicatorPosition?(t.insertAdjacentElement("afterend",i),t.parentNode.appendChild(i)):"before"===this.options.indicatorPosition&&t.insertAdjacentElement("beforebegin",i)}}})}reAttachElement(t){t.removeEventListener("blur",this.formElementValidate,!!this.passiveSupported&&{passive:!0}),t.removeEventListener("change",this.formElementValidate,!!this.passiveSupported&&{passive:!0}),t.removeEventListener("input",this.formElementValidate,!!this.passiveSupported&&{passive:!0}),t.hasAttribute("required")&&(t.addEventListener("blur",this.formElementValidate,!!this.passiveSupported&&{passive:!0}),(this.options.attachChange||this.form.dataset.attachChange)&&t.addEventListener("change",this.formElementValidate,!!this.passiveSupported&&{passive:!0}),(this.options.attachInput||this.form.dataset.attachInput)&&t.addEventListener("input",this.formElementValidate,!!this.passiveSupported&&{passive:!0}))}}const e=Array.from(document.querySelectorAll("form:not([novalidate]")),a=()=>{e.forEach(t=>{new i(t)})};a();export{a as def};
