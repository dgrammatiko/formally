const t={validClass:"is-valid",invalidClass:"is-invalid",indicator:!0,indicatorElement:"span",indicatorPosition:"after",indicatorClass:"invalid-feedback",invalidForm:"Form is not valid!",invalidFormAlert:!1};class e{constructor(e){if(!e||"HTMLFormElement"!==e.constructor.name)throw new Error("Validator needs a form element");if(this.form=e,!this.form.hasAttribute("novalidate")){if(this.passiveSupported=(()=>{let t=!1;try{const e={get passive(){return t=!0,!0}};window.addEventListener("test",null,e),window.removeEventListener("test",null,e)}catch(e){return t=!1,!1}return t})(),this.elementsForValidation=[],this.validateFormElement=this.validateFormElement.bind(this),this.attachElement=this.attachElement.bind(this),this.debounced=function(t,e){let i;return function(...s){i&&clearTimeout(i),i=setTimeout(()=>{e(...s),i=null},t)}}(2e3,this.validateFormElement),this.options=t,this.form.dataset)for(const t in this.form.dataset)Object.prototype.hasOwnProperty.call(this.options,t)&&(this.options[t]="indicator"===t||"invalidFormAlert"===t?"true"===this.form.dataset[t]:this.form.dataset[t]);[].slice.call(this.form.elements).forEach(t=>{t.hasAttribute("disabled")||"FIELDSET"===t.tagName||(this.elementsForValidation.push(t),t.addEventListener("blur",this.validateFormElement,!this.passiveSupported||{passive:!0}),t.addEventListener("change",this.validateFormElement,!this.passiveSupported||{passive:!0}),t.addEventListener("input",this.debounced,!this.passiveSupported||{passive:!0}),this.options.indicator&&this.elementInit&&"function"==typeof this.elementInit&&this.elementInit(t))})}}validateFormElement(t){let e=null;if(!t||!t.target||t.target.form!==this.form)throw new Error("The element needs to be a children of a form element");e=t.target,e.checkValidity(),this.notify&&"function"==typeof this.notify&&this.notify(e,e.validity.valid)}getCustomMessage(t,e,i){if(!t||!e||!i)return null;const s=t.dataset;if("object"==typeof s){if(i.typeMismatch&&s[e+"Mismatch"])return s[e+"Mismatch"];for(const t in s)if(Object.prototype.hasOwnProperty.call(s,t)&&!0===i[t])return s[t]}return null}attachElement(t){!t.hasAttribute("disabled")&&t.willValidate&&(t.removeEventListener("blur",this.validateFormElement,!this.passiveSupported||{passive:!0}),t.removeEventListener("change",this.validateFormElement,!this.passiveSupported||{passive:!0}),t.removeEventListener("input",this.debounced,!this.passiveSupported||{passive:!0}),t.addEventListener("blur",this.validateFormElement,!this.passiveSupported||{passive:!0}),t.addEventListener("change",this.validateFormElement,!this.passiveSupported||{passive:!0}),t.addEventListener("input",this.debounced,!this.passiveSupported||{passive:!0}),this.options.indicator&&this.elementInit&&"function"==typeof this.elementInit&&this.elementInit(t))}}Object.defineProperty(e,"switchClasses",{writable:!0,configurable:!0,value(t,e){e?(t.classList.remove(this.options.invalidClass),t.classList.add(this.options.validClass)):(t.classList.remove(this.options.validClass),t.classList.add(this.options.invalidClass))}}),Object.defineProperty(e,"elementInit",{writable:!0,configurable:!0,value(t){if(t.hasAttribute("disabled"))return;let e=t.closest(this.options.indicatorElement+"[aria-live]");e||(e=document.createElement(this.options.indicatorElement)),e.setAttribute("aria-live","polite");const i=(()=>{let t=()=>Math.floor(65536*(1+Math.random())).toString(16).substring(1);return t()+t()+"-"+t()+t()})();e.id=i,t.setAttribute("aria-controls",i),e.classList.add(this.options.indicatorClass),"after"===this.options.indicatorPosition?(t.insertAdjacentElement("afterend",e),t.parentNode.appendChild(e)):"before"===this.options.indicatorPosition&&t.insertAdjacentElement("beforebegin",e)}}),Object.defineProperty(e,"notify",{writable:!0,configurable:!0,value(t,e){if(t.hasAttribute("disabled"))return;const i=t.getAttribute("type"),s=e?null:this.getCustomMessage(t,t.type,t.validity);if(this.switchClasses(t,e),i&&"radio"===i){this.elementsForValidation.filter(e=>e.name!==t.name).forEach(t=>{this.switchClasses(t,e)})}if(this.form.dataset&&0!==Object.keys(this.form.dataset).length&&"true"===this.form.dataset.indicator){if(s){t.setCustomValidity("");const e=t.parentNode.querySelector('[aria-live="polite"]');e&&(e.innerText=s)}}else document.activeElement===t&&t.reportValidity()}}),Object.defineProperty(e,"invalidFormNotification",{writable:!0,configurable:!0,value(){this.form.dataset.invalidFormAlert&&alert("Please correct the invalid iputs")}});export{e as Formally};
