import { terser } from 'rollup-plugin-terser';
import gzipPlugin from 'rollup-plugin-gzip';
import { compress } from 'brotli';
import { gzip } from 'node-zopfli';
import babel from 'rollup-plugin-babel';
import resolve from '@rollup/plugin-node-resolve';
import commonjs from 'rollup-plugin-commonjs';

export default {
  input: 'src/nocode-bootstrap4.js',
  output: {
    sourcemap: false,
    format: 'iife',
    file: 'dist/nocode.iffe.es5.min.js',
    name: 'FormValidator',
  },
  plugins: [
    resolve(),
    commonjs(),
    babel({
      externalHelpers: false,
      sourceMap: false,
      exclude: [/\/core-js\//],
      presets: [
        [
          '@babel/preset-env',
          {
            modules: false,
            targets: {
              browsers: ['ie 11'],
            },
          },
        ],
      ],
    }),
    gzipPlugin({
      customCompression: content => gzip(Buffer.from(content)),
    }),
    gzipPlugin({
      customCompression: content => compress(Buffer.from(content)),
      fileName: '.br',
    }),
    terser()
  ]
};